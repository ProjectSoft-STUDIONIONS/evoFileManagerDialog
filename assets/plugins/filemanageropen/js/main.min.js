(l=>{l.extend(l.fn,{getIntCss:function(e){e=parseInt(this.css(e));return!isNaN(e)&&e}}),l.fn.Drags=function(e){var o=l.extend({zIndex:20,opacity:.7,handler:null,onMove:function(){},onDrop:function(){}},e),i={drag:function(e){e.preventDefault();var t=e.data.dragData;return t.target.css({left:t.left+e.pageX-t.offLeft,top:t.top+e.pageY-t.offTop}),t.onMove(e),!1},drop:function(e){var t=e.data.dragData;t.target.css(t.oldCss),t.onDrop(e),l(t.target).parent().unbind("mousemove",i.drag).unbind("mouseup",i.drop)}};return this.each(function(){var a=this,r=null;(r=void 0===o.handler||null==o.handler?l(a):"string"==typeof o.handler?l(o.handler,this):o.handle).bind("mousedown",{e:a},function(e){var t=l(e.data.e),n={};if("absolute"!=t.css("position")){try{t.position(n)}catch(e){}t.css("position","absolute")}n.opacity=t.getIntCss("opacity")||1,e={left:n.left||t.getIntCss("left")||0,top:n.top||t.getIntCss("top")||0,width:t.width()||t.getIntCss("width"),height:t.height()||t.getIntCss("height"),offLeft:e.pageX,offTop:e.pageY,oldCss:n,onMove:o.onMove,onDrop:o.onDrop,handler:r,target:t},t.css({opacity:o.opacity}),l(a).parent().bind("mousemove",{dragData:e},i.drag).bind("mouseup",{dragData:e},i.drop)})})}})(jQuery),((a,r,o)=>{r.lastImageCtrl="",r.lastFileCtrl="";var i,l,e,d,c,s,t,n,f=o('<div class="kcfinder-window"><div class="kcfinder-header"><span class="kcfinder-header-title">File Manager</span><span id="kcfinder-close" class="kcfinder-header-close">×</span></div><div class="kcfinder-body"><div id="kcfinder-frame"></div></div></div>'),p=r,u=0,g=r.filemanageropen_alert||0,v=r.filemanageropen_showbtn||0;windowloadCallback=function(){c=o("body"),s=o("#actions"),i=o("<div></div>").attr({id:"kcfinder_div"}),l=o("#kcfinder-frame",f),e=o("#kcfinder-close",f),c.append(i.append(f)),e.on("click",closeBtnCallback)},clearBodyStyle=function(e,t){lastFileCtrl=lastImageCtrl="",r.KCFinder=null,i.removeAttr("style"),l.html(""),e.length&&(e[0].style.overflow="",e[0].style.marginRight="",e[0].style.position=""),t.length&&(t[0].style.right="")},closeBtnCallback=function(e){return e.preventDefault(),clearBodyStyle(c,s),!1},openDialogWindow=function(){f.removeAttr("style"),s||windowloadCallback(),s.length&&(u=parseInt(s.getIntCss("right"))),o(".kcfinder-window",i).Drags({handler:".kcfinder-header",left:"30px",top:"30px",opacity:.85})},window_init=function(){var a;windowloadCallback(),a=r.open,r.open=function(){var e,t=arguments;if("FileManager"!=arguments[1]&&"FCKBrowseWindow"!=arguments[1])return a.apply(this,t);function n(){e.apply(this,arguments),clearBodyStyle(c,s)}e=r.KCFinder.callBackMultiple||r.KCFinder.callBack,r.KCFinder.callBackMultiple&&(r.KCFinder.callBackMultiple=n),r.KCFinder.callBack=n,OpenServerBrowser(arguments[0])}},directory=function(e){var t="",n="",e=e?a.getElementById(e):a.getElementsByName("photo")[0];return e?(n=e.value.replace(/assets\//g,"").replace(/^(.+?\/)((\.\.\/)?[^\/]+)$/,"$1"),console.log("Есть")):console.log("Нет"),""!=n&&(t+="&dir="+n),t},copyFilePath=function(t){var e=r.fmolang;function n(e){var t=r.fmolang;try{var n=p.document.createElement("textarea");n.value=e,p.document.body.appendChild(n),n.style.cssText="opacity: 0px; position: fixed; top: 0px; left: 0px",n.focus(),n.select(),p.document.execCommand("copy")||p.alert(t.nocopy),p.document.body.removeChild(n),g&&p.alert(t.copy+"\n"+e)}catch(e){p.alert(t.nocopy)}}t=t.join("\n"),clearBodyStyle(c,s),p.navigator.clipboard?p.navigator.clipboard.writeText(t).then(function(){g&&p.alert(e.copy+"\n"+t)},function(e){n(t)}):n(t)},r.SetUrlChange=function(e){var t;"createEvent"in a?((t=a.createEvent("HTMLEvents")).initEvent("change",!1,!0),e.dispatchEvent(t)):e.fireEvent("onchange")},r.OpenServerBrowser=function(e){var t,n,a=c.outerWidth(!0);c.css({position:"relative",overflow:"hidden"}),n=(t=c.outerWidth(!0))-a,a!=t&&(c.css({marginRight:n+"px"}),s.css({right:u+n+"px"})),o(".kcfinder-header .kcfinder-header-title",i).text("FileManager"),d=o("<iframe>").attr({class:"kcfinder_iframe",name:"kcfinder_iframe",src:e,frameborder:0,scrolling:"no"}),l.html(d),i.css({display:"flex"}),(d=o("iframe",l)).on("load",function(){var n=d[0].contentWindow.document;o(".kcfinder-header .kcfinder-header-title",i).text(n.title),o('a[href="kcact:maximize"]',n).hide();new MutationObserver(function(e,t){o(".kcfinder-header .kcfinder-header-title",i).text(n.title)}).observe(o("title",n)[0],{attributes:!0,childList:!0,subtree:!0})})},r.BrowseServer=function(e){console.log("BrowseServer",e),openDialogWindow();var t="";i.length&&"block"==i[0].style.display?clearBodyStyle(c,s):(e?(lastImageCtrl=e,r.KCFinder={callBack:function(e){var t=a.getElementById(lastImageCtrl);r.KCFinder=null,t.value=e,SetUrlChange(t),clearBodyStyle(c,s)}},t=directory(e),console.log("BrowseServer","Есть")):(r.KCFinder={callBack:function(e){var t=o('input[name="photo"]'),n=o("img[name=iphoto]");r.KCFinder=null,t.length&&(t.val(e),n.attr({src:"/"+e}),SetUrlChange(t[0])),clearBodyStyle(c,s)}},t=directory(),console.log("BrowseServer","Нет")),OpenServerBrowser(r.filemanageropen_url+"?type=images"+t))},r.BrowseFileServer=function(e){console.log("BrowseFileServer",e),openDialogWindow(),lastFileCtrl=e,i.length&&"block"==i[0].style.display?clearBodyStyle(c,s):(r.KCFinder={callBack:function(e){field=a.getElementById(lastFileCtrl),r.KCFinder=null,field.value=e,SetUrlChange(field),clearBodyStyle(c,s)}},e=directory(e),OpenServerBrowser(r.filemanageropen_url+"?type=files"+e))},r.addEventListener?r.addEventListener("load",window_init,!1):r.attachEvent&&r.attachEvent("onload",window_init),v&&(v=o("#actions")).length&&(n='<div class="evoflbw_wrapper btn-group">',n+='<a href="evoflbw:button" data-type="images" class="btn btn-secondary"><i class="fas fa-file-image fa"></i><span>'+(t=r.fmolang).images+"</span></a>",v.append(n=(n+='<a href="evoflbw:button" data-type="media" class="btn btn-secondary"><i class="fas fa-file-video fa"></i><span>'+t.media+"</span></a>")+('<a href="evoflbw:button" data-type="files" class="btn btn-secondary"><i class="fas fa-file-alt fa"></i><span>'+t.files+"</span></a>")+"</div>"),o('a[href*="evoflbw:"]').on("click",function(e){e.preventDefault();e=o(this).attr("data-type");return r.KCFinder={callBackMultiple:function(e){copyFilePath(e)}},openDialogWindow(),OpenServerBrowser(r.filemanageropen_url+"?type="+e),!1}))})(document,window,jQuery);
(o=>{o.extend(o.fn,{getIntCss:function(e){e=parseInt(this.css(e));return!isNaN(e)&&e}}),o.fn.Drags=function(e){var r=o.extend({zIndex:20,opacity:.7,handler:null,onMove:function(){},onDrop:function(){}},e),l={drag:function(e){e.preventDefault();var t=e.data.dragData;return t.target.css({left:t.left+e.pageX-t.offLeft,top:t.top+e.pageY-t.offTop}),t.onMove(e),!1},drop:function(e){var t=e.data.dragData;t.target.css(t.oldCss),t.onDrop(e),o(t.target).parent().unbind("mousemove",l.drag).unbind("mouseup",l.drop)}};return this.each(function(){var a=this,i=null;(i=void 0===r.handler||null==r.handler?o(a):"string"==typeof r.handler?o(r.handler,this):r.handle).bind("mousedown",{e:a},function(e){var t=o(e.data.e),n={};if("absolute"!=t.css("position")){try{t.position(n)}catch(e){}t.css("position","absolute")}n.opacity=t.getIntCss("opacity")||1,e={left:n.left||t.getIntCss("left")||0,top:n.top||t.getIntCss("top")||0,width:t.width()||t.getIntCss("width"),height:t.height()||t.getIntCss("height"),offLeft:e.pageX,offTop:e.pageY,oldCss:n,onMove:r.onMove,onDrop:r.onDrop,handler:i,target:t},t.css({opacity:r.opacity}),o(a).parent().bind("mousemove",{dragData:e},l.drag).bind("mouseup",{dragData:e},l.drop)})})}})(jQuery),((a,i,r)=>{i.lastImageCtrl="",i.lastFileCtrl="";var l,o,e,d,c,s,t,n,f=r('<div class="kcfinder-window"><div class="kcfinder-header"><span class="kcfinder-header-title">File Manager</span><span id="kcfinder-close" class="kcfinder-header-close">Ã—</span></div><div class="kcfinder-body"><div id="kcfinder-frame"></div></div></div>'),p=i,u=0,g=i.filemanageropen_alert||0,h=i.filemanageropen_showbtn||0;windowloadCallback=function(){c=r("body"),s=r("#actions"),l=r("<div></div>").attr({id:"kcfinder_div"}),o=r("#kcfinder-frame",f),e=r("#kcfinder-close",f),c.append(l.append(f)),e.on("click",closeBtnCallback)},clearBodyStyle=function(e,t){lastFileCtrl=lastImageCtrl="",i.KCFinder=null,l.removeAttr("style"),o.html(""),e.length&&(e[0].style.overflow="",e[0].style.marginRight="",e[0].style.position=""),t.length&&(t[0].style.right="")},closeBtnCallback=function(e){return e.preventDefault(),clearBodyStyle(c,s),!1},openDialogWindow=function(){f.removeAttr("style"),s||windowloadCallback(),s.length&&(u=parseInt(s.getIntCss("right"))),r(".kcfinder-window",l).Drags({handler:".kcfinder-header",left:"30px",top:"30px",opacity:.85})},window_init=function(){var a;windowloadCallback(),a=i.open,i.open=function(){var e,t=arguments;if("FileManager"!=arguments[1]&&"FCKBrowseWindow"!=arguments[1])return a.apply(this,t);function n(){e.apply(this,arguments),clearBodyStyle(c,s)}e=i.KCFinder.callBackMultiple||i.KCFinder.callBack,i.KCFinder.callBackMultiple&&(i.KCFinder.callBackMultiple=n),i.KCFinder.callBack=n,OpenServerBrowser(arguments[0])}},directory=function(e){var t="",n="",e=e?a.getElementById(e):a.getElementsByName("photo")[0];return""!=(n=e?e.value.replace(/assets\//g,"").replace(/^(.+?\/)((\.\.\/)?[^\/]+)$/,"$1"):n)&&(t+="&dir="+n),t},copyFilePath=function(t){var e=i.fmolang;function n(e){var t=i.fmolang;try{var n=p.document.createElement("textarea");n.value=e,p.document.body.appendChild(n),n.style.cssText="opacity: 0px; position: fixed; top: 0px; left: 0px",n.focus(),n.select(),p.document.execCommand("copy")||p.alert(t.nocopy),p.document.body.removeChild(n),g&&p.alert(t.copy+"\n"+e)}catch(e){p.alert(t.nocopy)}}t=t.join("\n"),clearBodyStyle(c,s),p.navigator.clipboard?p.navigator.clipboard.writeText(t).then(function(){g&&p.alert(e.copy+"\n"+t)},function(e){n(t)}):n(t)},i.SetUrlChange=function(e){var t;"createEvent"in a?((t=a.createEvent("HTMLEvents")).initEvent("change",!1,!0),e.dispatchEvent(t)):e.fireEvent("onchange")},i.OpenServerBrowser=function(e){var t,n,a=c.outerWidth(!0);c.css({position:"relative",overflow:"hidden"}),n=(t=c.outerWidth(!0))-a,a!=t&&(c.css({marginRight:n+"px"}),s.css({right:u+n+"px"})),r(".kcfinder-header .kcfinder-header-title",l).text("FileManager"),d=r("<iframe>").attr({class:"kcfinder_iframe",name:"kcfinder_iframe",src:e,frameborder:0,scrolling:"no"}),o.html(d),l.css({display:"flex"}),(d=r("iframe",o)).on("load",function(){var n=d[0].contentWindow.document;r(".kcfinder-header .kcfinder-header-title",l).text(n.title),r('a[href="kcact:maximize"]',n).hide();new MutationObserver(function(e,t){r(".kcfinder-header .kcfinder-header-title",l).text(n.title)}).observe(r("title",n)[0],{attributes:!0,childList:!0,subtree:!0})})},i.BrowseServer=function(e){openDialogWindow();var t="";l.length&&"block"==l[0].style.display?clearBodyStyle(c,s):(t=e?(lastImageCtrl=e,i.KCFinder={callBack:function(e){var t=a.getElementById(lastImageCtrl);i.KCFinder=null,t.value=e,SetUrlChange(t),clearBodyStyle(c,s)}},directory(e)):(i.KCFinder={callBack:function(e){var t=r('input[name="photo"]'),n=r("img[name=iphoto]");i.KCFinder=null,t.length&&(t.val(e),n.attr({src:"/"+e}),SetUrlChange(t[0])),clearBodyStyle(c,s)}},directory()),OpenServerBrowser(i.filemanageropen_url+"?type=images"+t))},i.BrowseFileServer=function(e){openDialogWindow(),lastFileCtrl=e,l.length&&"block"==l[0].style.display?clearBodyStyle(c,s):(i.KCFinder={callBack:function(e){field=a.getElementById(lastFileCtrl),i.KCFinder=null,field.value=e,SetUrlChange(field),clearBodyStyle(c,s)}},e=directory(e),OpenServerBrowser(i.filemanageropen_url+"?type=files"+e))},i.addEventListener?i.addEventListener("load",window_init,!1):i.attachEvent&&i.attachEvent("onload",window_init),h&&(h=r("#actions")).length&&(n='<div class="evoflbw_wrapper btn-group">',n+='<a href="evoflbw:button" data-type="images" class="btn btn-secondary"><i class="fas fa-file-image fa"></i><span>'+(t=i.fmolang).images+"</span></a>",h.append(n=(n+='<a href="evoflbw:button" data-type="media" class="btn btn-secondary"><i class="fas fa-file-video fa"></i><span>'+t.media+"</span></a>")+('<a href="evoflbw:button" data-type="files" class="btn btn-secondary"><i class="fas fa-file-alt fa"></i><span>'+t.files+"</span></a>")+"</div>"),r('a[href*="evoflbw:"]').on("click",function(e){e.preventDefault();e=r(this).attr("data-type");return i.KCFinder={callBackMultiple:function(e){copyFilePath(e)}},openDialogWindow(),OpenServerBrowser(i.filemanageropen_url+"?type="+e),!1}))})(document,window,jQuery);